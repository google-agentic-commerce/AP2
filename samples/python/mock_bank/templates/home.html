<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mock Bank - Payment Transactions</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: white;
        border-radius: 12px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        overflow: hidden;
      }

      .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
      }

      .header h1 {
        font-size: 2rem;
        margin-bottom: 10px;
      }

      .header p {
        opacity: 0.9;
        font-size: 1rem;
      }

      .content {
        padding: 30px;
      }

      .refresh-btn {
        background: #667eea;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1rem;
        margin-bottom: 30px;
        transition: background 0.3s;
      }

      .refresh-btn:hover {
        background: #5568d3;
      }

      .payment-method-section {
        margin-bottom: 40px;
      }

      .payment-method-header {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-bottom: 20px;
        padding: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 8px;
        color: white;
      }

      .payment-method-icon {
        font-size: 2rem;
      }

      .payment-method-title h2 {
        font-size: 1.5rem;
        margin-bottom: 5px;
      }

      .payment-method-title p {
        opacity: 0.9;
        font-size: 0.9rem;
      }

      .transactions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 20px;
      }

      .transaction-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        transition:
          transform 0.2s,
          box-shadow 0.2s;
      }

      .transaction-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .transaction-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f0f0;
      }

      .transaction-id {
        font-weight: bold;
        color: #667eea;
        font-size: 1.1rem;
        word-break: break-all;
        max-width: 200px;
        line-height: 1.3;
      }

      .status-badge {
        display: inline-block;
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
      }

      .status-badge[data-status="pending"] {
        background: #fff3cd;
        color: #856404;
      }

      .status-badge[data-status="success"] {
        background: #d4edda;
        color: #155724;
      }

      .status-badge[data-status="failure"] {
        background: #f8d7da;
        color: #721c24;
      }

      .transaction-details {
        margin-bottom: 15px;
      }

      .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #f5f5f5;
      }

      .detail-row:last-child {
        border-bottom: none;
      }

      .detail-label {
        color: #666;
        font-size: 0.9rem;
      }

      .detail-value {
        font-weight: 500;
        color: #333;
        text-align: right;
      }

      .payment-info {
        background: #f8f9fa;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 15px;
      }

      .payment-info-item {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
      }

      .payment-info-item:last-child {
        margin-bottom: 0;
      }

      .payment-icon {
        font-size: 1.2rem;
      }

      .masked-card {
        font-family: "Courier New", monospace;
        letter-spacing: 2px;
        font-weight: bold;
      }

      .card-category-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
        margin-left: 8px;
      }

      .card-category-badge[data-card-category="credit"] {
        background: #e3f2fd;
        color: #1976d2;
        border: 1px solid #1976d2;
      }

      .card-category-badge[data-card-category="debit"] {
        background: #e8f5e9;
        color: #388e3c;
        border: 1px solid #388e3c;
      }

      .customer-name {
        font-weight: 600;
        color: #333;
        margin-bottom: 8px;
      }

      .action-buttons {
        display: flex;
        gap: 8px;
      }

      .btn {
        flex: 1;
        padding: 10px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.9rem;
        font-weight: 600;
        transition: all 0.3s;
      }

      .btn-success {
        background: #28a745;
        color: white;
      }

      .btn-success:hover {
        background: #218838;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(40, 167, 69, 0.3);
      }

      .btn-failure {
        background: #dc3545;
        color: white;
      }

      .btn-failure:hover {
        background: #c82333;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .completed-label {
        text-align: center;
        color: #6c757d;
        font-style: italic;
        padding: 10px;
      }

      .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #6c757d;
      }

      .empty-state svg {
        width: 100px;
        height: 100px;
        margin-bottom: 20px;
        opacity: 0.5;
      }

      .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: 10px;
      }

      .empty-state p {
        font-size: 1rem;
      }

      .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 16px 24px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        display: none;
        animation: slideIn 0.3s ease-out;
        z-index: 1000;
      }

      .notification.show {
        display: block;
      }

      .notification.success {
        background: #28a745;
      }

      .notification.error {
        background: #dc3545;
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .content {
          padding: 15px;
        }

        .transactions-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div id="notification" class="notification"></div>

    <div class="container">
      <div class="header">
        <h1>üè¶ Mock Bank Server</h1>
        <p>Payment Transaction Management</p>
      </div>

      <div class="content">
        <button class="refresh-btn" onclick="location.reload()">
          üîÑ Refresh
        </button>

        {% if grouped_transactions %} {% for method, transactions in
        grouped_transactions.items() %}
        <div class="payment-method-section">
          <div class="payment-method-header">
            <div class="payment-method-icon">
              {% if method == 'UPI_COLLECT' %} üí≥ {% elif method == 'CARD' %} üîê
              {% else %} üí∞ {% endif %}
            </div>
            <div class="payment-method-title">
              <h2>{{ method.replace('_', ' ') }}</h2>
              <p>
                {{ transactions|length }} transaction{{ 's' if
                transactions|length != 1 else '' }}
              </p>
            </div>
          </div>

          <div class="transactions-grid">
            {% for txn in transactions %}
            <div class="transaction-card">
              <div class="transaction-header">
                <span class="transaction-id">{{ txn.txn_id }}</span>
                <span class="status-badge" data-status="{{ txn.status|lower }}">
                  {{ txn.status }}
                </span>
              </div>

              {% if txn.customer_data and txn.customer_data.get('first_name') %}
              <div class="customer-name">
                üë§ {{ txn.customer_data.first_name }} {{
                txn.customer_data.last_name }}
              </div>
              {% endif %}

              <div class="payment-info">
                {% if method == 'UPI_COLLECT' %} {% if txn.upi_id %}
                <div class="payment-info-item">
                  <span class="payment-icon">üì±</span>
                  <strong>{{ txn.upi_id }}</strong>
                </div>
                {% endif %} {% elif method == 'CARD' %}
                <div class="payment-info-item">
                  <span class="payment-icon">üí≥</span>
                  <span class="masked-card"
                    >{{ txn.get('card_number', 'XXXX XXXX XXXX XXXX') }}</span
                  >
                  {% if txn.get('card_type') %}
                  <span
                    class="card-category-badge"
                    style="
                      background: #f3e5f5;
                      color: #7b1fa2;
                      border: 1px solid #7b1fa2;
                    "
                    >{{ txn.card_type }}</span
                  >
                  {% endif %} {% if txn.get('card_category') %}
                  <span
                    class="card-category-badge"
                    data-card-category="{{txn.card_category|lower}}">
                    {{ txn.card_category }}
                  </span>
                  {% endif %}
                </div>
                {% if txn.get('card_holder') %}
                <div class="payment-info-item">
                  <span class="payment-icon">üë§</span>
                  <span>{{ txn.card_holder }}</span>
                </div>
                {% endif %} {% if txn.get('expiry_month') and
                txn.get('expiry_year') %}
                <div class="payment-info-item">
                  <span class="payment-icon">üìÖ</span>
                  <span>Exp: {{ txn.expiry_month }}/{{ txn.expiry_year }}</span>
                </div>
                {% endif %} {% endif %}
              </div>

              <div class="transaction-details">
                <div class="detail-row">
                  <span class="detail-label">Amount</span>
                  <span class="detail-value"
                    >{{ txn.amount }} {{ txn.currency }}</span
                  >
                </div>
                {% if txn.description %}
                <div class="detail-row">
                  <span class="detail-label">Description</span>
                  <span class="detail-value">{{ txn.description }}</span>
                </div>
                {% endif %}
                <div class="detail-row">
                  <span class="detail-label">Timestamp</span>
                  <span class="detail-value">{{ txn.timestamp }}</span>
                </div>
              </div>

              {% if txn.status == 'PENDING' %}
              <div class="action-buttons">
                <button
                  class="btn btn-success"
                  onclick="_updateStatus('{{ txn.txn_id }}', 'SUCCESS')">
                  ‚úì Approve
                </button>
                <button
                  class="btn btn-failure"
                  onclick="_updateStatus('{{ txn.txn_id }}', 'FAILURE')">
                  ‚úó Decline
                </button>
              </div>
              {% else %}
              <div class="completed-label">Transaction Completed</div>
              {% endif %}
            </div>
            {% endfor %}
          </div>
        </div>
        {% endfor %} {% else %}
        <div class="empty-state">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <h3>No Transactions Yet</h3>
          <p>Create a payment transaction using the POST /payments endpoint</p>
        </div>
        {% endif %}
      </div>
    </div>

    <script>
      function showNotification(message, type = "success") {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.className = `notification ${type} show`;

        setTimeout(() => {
          notification.classList.remove("show");
        }, 3000);
      }

      async function _updateStatus(txnId, status) {
        try {
          const response = await fetch(`/action/${txnId}`, {
            method: "PUT",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ status: status }),
          });

          const data = await response.json();

          if (data.success) {
            showNotification(
              `Transaction ${txnId} marked as ${status}`,
              "success"
            );
            // Reload page after a short delay to show the notification
            setTimeout(() => location.reload(), 1000);
          } else {
            showNotification(`Error: ${data.error}`, "error");
          }
        } catch (error) {
          showNotification(`Error: ${error.message}`, "error");
        }
      }
    </script>
  </body>
</html>
